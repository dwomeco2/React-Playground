import{r as _,R as Z}from"./index-e3a0434a.js";let ee=0;function de(t,s){const l=`atom${++ee}`,a={toString:()=>l};return typeof t=="function"?a.read=t:(a.init=t,a.read=E=>E(a),a.write=(E,R,f)=>R(a,typeof f=="function"?f(E(a)):f)),s&&(a.write=s),a}const z=t=>"init"in t,m=t=>!!t.write,U=new WeakMap,te=(t,s)=>{U.set(t,s),t.catch(()=>{}).finally(()=>U.delete(t))},$=(t,s)=>{const l=U.get(t);l&&(U.delete(t),l(s))},G=(t,s)=>{t.status="fulfilled",t.value=s},H=(t,s)=>{t.status="rejected",t.reason=s},V=(t,s)=>"v"in t&&"v"in s&&Object.is(t.v,s.v),J=(t,s)=>"e"in t&&"e"in s&&Object.is(t.e,s.e),W=t=>"v"in t&&t.v instanceof Promise,B=t=>{if("e"in t)throw t.e;return t.v},ne=()=>{const t=new WeakMap,s=new WeakMap,l=new Map;let a,E,R;({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&(a=new Set,E=new Set,R=new Set);const f=e=>t.get(e),D=(e,n)=>{({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&Object.freeze(n);const o=t.get(e);if(t.set(e,n),l.has(e)||l.set(e,o),o&&W(o)){const r="v"in n?n.v instanceof Promise?n.v:Promise.resolve(n.v):Promise.reject(n.e);$(o.v,r)}},v=(e,n,o)=>{const r=new Map;let u=!1;o.forEach(c=>{const i=c===e?n:f(c);i?(r.set(c,i),n.d.get(c)!==i&&(u=!0)):({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&console.warn("[Bug] atom state not found")}),(u||n.d.size!==r.size)&&(n.d=r)},g=(e,n,o)=>{const r=f(e),u={d:(r==null?void 0:r.d)||new Map,v:n};return o&&v(e,u,o),r&&V(r,u)&&r.d===u.d?r:(D(e,u),u)},O=(e,n,o)=>{const r=f(e),u={d:(r==null?void 0:r.d)||new Map,e:n};return o&&v(e,u,o),r&&J(r,u)&&r.d===u.d?r:(D(e,u),u)},A=e=>{const n=f(e);if(n&&(n.d.forEach((d,p)=>{p!==e&&!s.has(p)&&A(p)}),Array.from(n.d).every(([d,p])=>d===e||f(d)===p)))return n;const o=new Set;let r=!0;const u=d=>{if(o.add(d),d===e){const S=f(d);if(S)return B(S);if(z(d))return d.init;throw new Error("no atom init")}const p=A(d);return B(p)};let c,i;const M={get signal(){return c||(c=new AbortController),c.signal},get setSelf(){return({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&!m(e)&&console.warn("setSelf function cannot be used with read-only atom"),!i&&m(e)&&(i=(...d)=>{if(({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&r&&console.warn("setSelf function cannot be called in sync"),!r)return P(e,...d)}),i}};try{const d=e.read(u,M);if(d instanceof Promise){let p;const S=new Promise((y,Y)=>{let h=!1;d.then(w=>{h||(h=!0,g(e,S,o),G(S,w),y(w))},w=>{h||(h=!0,g(e,S,o),H(S,w),Y(w))}),p=w=>{h||(h=!0,w.then(k=>G(S,k),k=>H(S,k)),y(w))}});return S.status="pending",te(S,y=>{y&&p(y),c==null||c.abort()}),g(e,S,o)}return g(e,d,o)}catch(d){return O(e,d,o)}finally{r=!1}},q=e=>B(A(e)),N=e=>{let n=s.get(e);return n||(n=x(e)),n},L=(e,n)=>!n.l.size&&(!n.t.size||n.t.size===1&&n.t.has(e)),Q=e=>{const n=s.get(e);n&&L(e,n)&&C(e)},j=e=>{const n=s.get(e);n==null||n.t.forEach(o=>{if(o!==e){const r=f(o),u=A(o);(!r||!V(r,u))&&j(o)}})},T=(e,...n)=>{let o=!0;const r=i=>B(A(i)),u=(i,...M)=>{let d;if(i===e){if(!z(i))throw new Error("atom not writable");const p=f(i),S=g(i,M[0]);(!p||!V(p,S))&&j(i)}else d=T(i,...M);return o||b(),d},c=e.write(r,u,...n);return o=!1,c},P=(e,...n)=>{const o=T(e,...n);return b(),o},x=(e,n)=>{const o={t:new Set(n&&[n]),l:new Set};if(s.set(e,o),({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&R.add(e),A(e).d.forEach((r,u)=>{const c=s.get(u);c?c.t.add(e):u!==e&&x(u,e)}),A(e),m(e)&&e.onMount){const r=e.onMount((...u)=>P(e,...u));r&&(o.u=r)}return o},C=e=>{var n;const o=(n=s.get(e))==null?void 0:n.u;o&&o(),s.delete(e),({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&R.delete(e);const r=f(e);r?(W(r)&&$(r.v),r.d.forEach((u,c)=>{if(c!==e){const i=s.get(c);i&&(i.t.delete(e),L(c,i)&&C(c))}})):({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&console.warn("[Bug] could not find atom state to unmount",e)},X=(e,n,o)=>{const r=new Set(n.d.keys());o==null||o.forEach((u,c)=>{if(r.has(c)){r.delete(c);return}const i=s.get(c);i&&(i.t.delete(e),L(c,i)&&C(c))}),r.forEach(u=>{const c=s.get(u);c?c.t.add(e):s.has(e)&&x(u,e)})},b=()=>{for(;l.size;){const e=Array.from(l);l.clear(),e.forEach(([n,o])=>{const r=f(n);if(r){r.d!==(o==null?void 0:o.d)&&X(n,r,o==null?void 0:o.d);const u=s.get(n);u&&!(o&&!W(o)&&(V(o,r)||J(o,r)))&&u.l.forEach(c=>c())}else({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&console.warn("[Bug] no atom state to flush")})}({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&(a.forEach(e=>e()),E.forEach(e=>e("state")))},I=(e,n)=>{const o=N(e);b();const r=o.l;return r.add(n),({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&E.forEach(u=>u("sub")),()=>{r.delete(n),Q(e),({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&E.forEach(u=>u("unsub"))}};return({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"?{get:q,set:P,sub:I,dev_subscribe_state:e=>(console.warn("[DEPRECATED] dev_subscribe_state is deprecated and will be removed in the next minor version. use dev_subscribe_store instead."),a.add(e),()=>{a.delete(e)}),dev_subscribe_store:e=>(E.add(e),()=>{E.delete(e)}),dev_get_mounted_atoms:()=>R.values(),dev_get_atom_state:e=>t.get(e),dev_get_mounted:e=>s.get(e),dev_restore_atoms:e=>{for(const[n,o]of e)z(n)&&(g(n,o),j(n));b()}}:{get:q,set:P,sub:I}};let F;const oe=()=>(F||(F=ne()),F),re=_.createContext(void 0),K=t=>{const s=_.useContext(re);return(t==null?void 0:t.store)||s||oe()},se=t=>t instanceof Promise,ue=Z.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(s=>{t.status="fulfilled",t.value=s},s=>{t.status="rejected",t.reason=s}),t)});function ce(t,s){const l=K(s),[[a,E,R],f]=_.useReducer(g=>{const O=l.get(t);return Object.is(g[0],O)&&g[1]===l&&g[2]===t?g:[O,l,t]},void 0,()=>[l.get(t),l,t]);let D=a;(E!==l||R!==t)&&(f(),D=l.get(t));const v=s==null?void 0:s.delay;return _.useEffect(()=>{const g=l.sub(t,()=>{if(typeof v=="number"){setTimeout(f,v);return}f()});return f(),g},[l,t,v]),_.useDebugValue(D),se(D)?ue(D):D}function ie(t,s){const l=K(s);return _.useCallback((...E)=>{if(({BASE_URL:"/react-playground/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&"production")!=="production"&&!("write"in t))throw new Error("not writable atom");return l.set(t,...E)},[l,t])}function fe(t,s){return[ce(t,s),ie(t,s)]}export{de as a,ce as b,fe as c,ie as u};
