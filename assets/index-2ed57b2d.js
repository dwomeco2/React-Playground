import{S as Z,s as D,n as Re,i as _,b as W,t as Se,f as xe,c as Oe,d as K,e as Qe,g as Q,h as J,k as je,r as v,u as ee,p as Ee,l as N,j as a,P as F,m as Ce}from"./index-7cc1b056.js";import{z as p}from"./index-45b59163.js";import{a as te,u as V,b as Ie,c as we}from"./react-4bfb2b49.js";class re extends Z{constructor(e,r){super(),this.client=e,this.options=r,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(r)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.length===1&&(this.currentQuery.addObserver(this),z(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.listeners.length||this.destroy()}shouldFetchOnReconnect(){return L(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return L(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=[],this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(e,r){const s=this.options,i=this.currentQuery;if(this.options=this.client.defaultQueryOptions(e),D(s,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=s.queryKey),this.updateQuery();const n=this.hasListeners();n&&G(this.currentQuery,i,this.options,s)&&this.executeFetch(),this.updateResult(r),n&&(this.currentQuery!==i||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.updateStaleTimeout();const u=this.computeRefetchInterval();n&&(this.currentQuery!==i||this.options.enabled!==s.enabled||u!==this.currentRefetchInterval)&&this.updateRefetchInterval(u)}getOptimisticResult(e){const r=this.client.getQueryCache().build(this.client,e);return this.createResult(r,e)}getCurrentResult(){return this.currentResult}trackResult(e){const r={};return Object.keys(e).forEach(s=>{Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(s),e[s])})}),r}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:e,...r}={}){return this.fetch({...r,meta:{refetchPage:e}})}fetchOptimistic(e){const r=this.client.defaultQueryOptions(e),s=this.client.getQueryCache().build(this.client,r);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,r))}fetch(e){var r;return this.executeFetch({...e,cancelRefetch:(r=e.cancelRefetch)!=null?r:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let r=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(r=r.catch(Re)),r}updateStaleTimeout(){if(this.clearStaleTimeout(),_||this.currentResult.isStale||!W(this.options.staleTime))return;const r=Se(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},r)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!=null?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(_||this.options.enabled===!1||!W(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||xe.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(e,r){const s=this.currentQuery,i=this.options,n=this.currentResult,u=this.currentResultState,l=this.currentResultOptions,d=e!==s,c=d?e.state:this.currentQueryInitialState,f=d?this.currentResult:this.previousQueryResult,{state:o}=e;let{dataUpdatedAt:h,error:m,errorUpdatedAt:g,fetchStatus:x,status:R}=o,E=!1,T=!1,S;if(r._optimisticResults){const b=this.hasListeners(),I=!b&&z(e,r),ge=b&&G(e,s,r,i);(I||ge)&&(x=Oe(e.options.networkMode)?"fetching":"paused",h||(R="loading")),r._optimisticResults==="isRestoring"&&(x="idle")}if(r.keepPreviousData&&!o.dataUpdatedAt&&f!=null&&f.isSuccess&&R!=="error")S=f.data,h=f.dataUpdatedAt,R=f.status,E=!0;else if(r.select&&typeof o.data<"u")if(n&&o.data===(u==null?void 0:u.data)&&r.select===this.selectFn)S=this.selectResult;else try{this.selectFn=r.select,S=r.select(o.data),S=K(n==null?void 0:n.data,S,r),this.selectResult=S,this.selectError=null}catch(b){this.selectError=b}else S=o.data;if(typeof r.placeholderData<"u"&&typeof S>"u"&&R==="loading"){let b;if(n!=null&&n.isPlaceholderData&&r.placeholderData===(l==null?void 0:l.placeholderData))b=n.data;else if(b=typeof r.placeholderData=="function"?r.placeholderData():r.placeholderData,r.select&&typeof b<"u")try{b=r.select(b),this.selectError=null}catch(I){this.selectError=I}typeof b<"u"&&(R="success",S=K(n==null?void 0:n.data,b,r),T=!0)}this.selectError&&(m=this.selectError,S=this.selectResult,g=Date.now(),R="error");const k=x==="fetching",C=R==="loading",y=R==="error";return{status:R,fetchStatus:x,isLoading:C,isSuccess:R==="success",isError:y,isInitialLoading:C&&k,data:S,dataUpdatedAt:h,error:m,errorUpdatedAt:g,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>c.dataUpdateCount||o.errorUpdateCount>c.errorUpdateCount,isFetching:k,isRefetching:k&&!C,isLoadingError:y&&o.dataUpdatedAt===0,isPaused:x==="paused",isPlaceholderData:T,isPreviousData:E,isRefetchError:y&&o.dataUpdatedAt!==0,isStale:$(e,r),refetch:this.refetch,remove:this.remove}}updateResult(e){const r=this.currentResult,s=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,D(s,r))return;this.currentResult=s;const i={cache:!0},n=()=>{if(!r)return!0;const{notifyOnChangeProps:u}=this.options;if(u==="all"||!u&&!this.trackedProps.size)return!0;const l=new Set(u??this.trackedProps);return this.options.useErrorBoundary&&l.add("error"),Object.keys(this.currentResult).some(d=>{const c=d;return this.currentResult[c]!==r[c]&&l.has(c)})};(e==null?void 0:e.listeners)!==!1&&n()&&(i.listeners=!0),this.notify({...i,...e})}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const r=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(r==null||r.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const r={};e.type==="success"?r.onSuccess=!e.manual:e.type==="error"&&!Qe(e.error)&&(r.onError=!0),this.updateResult(r),this.hasListeners()&&this.updateTimers()}notify(e){Q.batch(()=>{if(e.onSuccess){var r,s,i,n;(r=(s=this.options).onSuccess)==null||r.call(s,this.currentResult.data),(i=(n=this.options).onSettled)==null||i.call(n,this.currentResult.data,null)}else if(e.onError){var u,l,d,c;(u=(l=this.options).onError)==null||u.call(l,this.currentResult.error),(d=(c=this.options).onSettled)==null||d.call(c,void 0,this.currentResult.error)}e.listeners&&this.listeners.forEach(f=>{f(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function Te(t,e){return e.enabled!==!1&&!t.state.dataUpdatedAt&&!(t.state.status==="error"&&e.retryOnMount===!1)}function z(t,e){return Te(t,e)||t.state.dataUpdatedAt>0&&L(t,e,e.refetchOnMount)}function L(t,e,r){if(e.enabled!==!1){const s=typeof r=="function"?r(t):r;return s==="always"||s!==!1&&$(t,e)}return!1}function G(t,e,r,s){return r.enabled!==!1&&(t!==e||s.enabled===!1)&&(!r.suspense||t.state.status!=="error")&&$(t,r)}function $(t,e){return t.isStaleByTime(e.staleTime)}class ke extends Z{constructor(e,r){super(),this.client=e,this.queries=[],this.result=[],this.observers=[],this.observersMap={},r&&this.setQueries(r)}onSubscribe(){this.listeners.length===1&&this.observers.forEach(e=>{e.subscribe(r=>{this.onUpdate(e,r)})})}onUnsubscribe(){this.listeners.length||this.destroy()}destroy(){this.listeners=[],this.observers.forEach(e=>{e.destroy()})}setQueries(e,r){this.queries=e,Q.batch(()=>{const s=this.observers,i=this.findMatchingObservers(this.queries);i.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions,r));const n=i.map(c=>c.observer),u=Object.fromEntries(n.map(c=>[c.options.queryHash,c])),l=n.map(c=>c.getCurrentResult()),d=n.some((c,f)=>c!==s[f]);s.length===n.length&&!d||(this.observers=n,this.observersMap=u,this.result=l,this.hasListeners()&&(J(s,n).forEach(c=>{c.destroy()}),J(n,s).forEach(c=>{c.subscribe(f=>{this.onUpdate(c,f)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(e=>e.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(e){return this.findMatchingObservers(e).map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions))}findMatchingObservers(e){const r=this.observers,s=e.map(o=>this.client.defaultQueryOptions(o)),i=s.flatMap(o=>{const h=r.find(m=>m.options.queryHash===o.queryHash);return h!=null?[{defaultedQueryOptions:o,observer:h}]:[]}),n=i.map(o=>o.defaultedQueryOptions.queryHash),u=s.filter(o=>!n.includes(o.queryHash)),l=r.filter(o=>!i.some(h=>h.observer===o)),d=o=>{const h=this.client.defaultQueryOptions(o),m=this.observersMap[h.queryHash];return m??new re(this.client,h)},c=u.map((o,h)=>{if(o.keepPreviousData){const m=l[h];if(m!==void 0)return{defaultedQueryOptions:o,observer:m}}return{defaultedQueryOptions:o,observer:d(o)}}),f=(o,h)=>s.indexOf(o.defaultedQueryOptions)-s.indexOf(h.defaultedQueryOptions);return i.concat(c).sort(f)}onUpdate(e,r){const s=this.observers.indexOf(e);s!==-1&&(this.result=je(this.result,s,r),this.notify())}notify(){Q.batch(()=>{this.listeners.forEach(e=>{e(this.result)})})}}var A={},Ne={get exports(){return A},set exports(t){A=t}},se={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w=v;function Me(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Pe=typeof Object.is=="function"?Object.is:Me,Fe=w.useState,Le=w.useEffect,Ae=w.useLayoutEffect,Ue=w.useDebugValue;function Be(t,e){var r=e(),s=Fe({inst:{value:r,getSnapshot:e}}),i=s[0].inst,n=s[1];return Ae(function(){i.value=r,i.getSnapshot=e,M(i)&&n({inst:i})},[t,r,e]),Le(function(){return M(i)&&n({inst:i}),t(function(){M(i)&&n({inst:i})})},[t]),Ue(r),r}function M(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Pe(t,r)}catch{return!0}}function qe(t,e){return e()}var He=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?qe:Be;se.useSyncExternalStore=w.useSyncExternalStore!==void 0?w.useSyncExternalStore:He;(function(t){t.exports=se})(Ne);const ne=A.useSyncExternalStore,ie=v.createContext(!1),oe=()=>v.useContext(ie);ie.Provider;function $e(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}const De=v.createContext($e()),ue=()=>v.useContext(De);function _e(t,e){return typeof t=="function"?t(...e):!!t}const ae=(t,e)=>{(t.suspense||t.useErrorBoundary)&&(e.isReset()||(t.retryOnMount=!1))},le=t=>{v.useEffect(()=>{t.clearReset()},[t])},ce=({result:t,errorResetBoundary:e,useErrorBoundary:r,query:s})=>t.isError&&!e.isReset()&&!t.isFetching&&_e(r,[t.error,s]),de=t=>{t.suspense&&typeof t.staleTime!="number"&&(t.staleTime=1e3)},he=(t,e)=>t.isLoading&&t.isFetching&&!e,U=(t,e,r)=>(t==null?void 0:t.suspense)&&he(e,r),B=(t,e,r)=>e.fetchOptimistic(t).then(({data:s})=>{t.onSuccess==null||t.onSuccess(s),t.onSettled==null||t.onSettled(s,null)}).catch(s=>{r.clearReset(),t.onError==null||t.onError(s),t.onSettled==null||t.onSettled(void 0,s)});function We({queries:t,context:e}){const r=ee({context:e}),s=oe(),i=v.useMemo(()=>t.map(o=>{const h=r.defaultQueryOptions(o);return h._optimisticResults=s?"isRestoring":"optimistic",h}),[t,r,s]),[n]=v.useState(()=>new ke(r,i)),u=n.getOptimisticResult(i);ne(v.useCallback(o=>s?()=>{}:n.subscribe(Q.batchCalls(o)),[n,s]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),v.useEffect(()=>{n.setQueries(i,{listeners:!1})},[i,n]);const l=ue();i.forEach(o=>{ae(o,l),de(o)}),le(l);const c=u.some((o,h)=>U(i[h],o,s))?u.flatMap((o,h)=>{const m=i[h],g=n.getObservers()[h];if(m&&g){if(U(m,o,s))return B(m,g,l);he(o,s)&&B(m,g,l)}return[]}):[];if(c.length>0)throw Promise.all(c);const f=u.find((o,h)=>{var m,g;return ce({result:o,errorResetBoundary:l,useErrorBoundary:(m=(g=i[h])==null?void 0:g.useErrorBoundary)!=null?m:!1,query:n.getQueries()[h]})});if(f!=null&&f.error)throw f.error;return u}function Ke(t,e){const r=ee({context:t.context}),s=oe(),i=ue(),n=r.defaultQueryOptions(t);n._optimisticResults=s?"isRestoring":"optimistic",n.onError&&(n.onError=Q.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=Q.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=Q.batchCalls(n.onSettled)),de(n),ae(n,i),le(i);const[u]=v.useState(()=>new e(r,n)),l=u.getOptimisticResult(n);if(ne(v.useCallback(d=>s?()=>{}:u.subscribe(Q.batchCalls(d)),[u,s]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),v.useEffect(()=>{u.setOptions(n,{listeners:!1})},[n,u]),U(n,l,s))throw B(n,u,i);if(ce({result:l,errorResetBoundary:i,useErrorBoundary:n.useErrorBoundary,query:u.getCurrentQuery()}))throw l.error;return n.notifyOnChangeProps?l:u.trackResult(l)}function fe(t,e,r){const s=Ee(t,e,r);return Ke(s,re)}const Je=p.array(p.number()).default([]),Ve=p.object({id:p.number(),deleted:p.boolean().optional().default(!1),type:p.string(),by:p.string().optional().default(""),time:p.number().optional(),dead:p.boolean().optional().default(!1),kids:p.array(p.number()).optional().default([]),descendants:p.number().optional(),score:p.number().optional(),title:p.string().optional().default(""),url:p.string().optional().default("")}),ze=p.object({id:p.number(),deleted:p.boolean().optional().default(!1),type:p.string(),by:p.string().optional().default(""),time:p.number().optional(),kids:p.array(p.number()).optional().default([]),parent:p.number().optional(),text:p.string().optional().default("")}),Ge=Ve.merge(ze),Xe=async()=>{const t=await fetch("https://hacker-news.firebaseio.com/v0/topstories.json");return t.status!==200?Promise.reject(new Error(`Failed to fetch top stories res.status:${t.status}`)):t.json().then(async e=>{const r=Je.safeParse(e);return r.success?r.data:Promise.reject(new Error(`Failed to parse top stories json:${JSON.stringify(e)}`))})},me=async t=>{const e=await fetch(`https://hacker-news.firebaseio.com/v0/item/${t}.json`);return e.status!==200?Promise.reject(new Error(`Failed to fetch item ${t} res.status:${e.status}`)):e.json().then(async r=>{const s=Ge.safeParse(r);return s.success?s.data:Promise.reject(new Error(`Failed to parse item itemID:${t} json:${JSON.stringify(r)}`))})},j={maxPageItems:9,maxCommentsPerPage:20,hackerNewsStoryContentAtom:te({}),toggleSideBarAtom:Ye(!0)};function Ye(t=!1){const e=te(t,(r,s,i)=>{const n=i??!r(e);s(e,n)});return e}const Ze=({data:t,page:e})=>{const r=rt(t.id),[s,i,n]=ye(e,j.maxCommentsPerPage,t.kids);return{totalPages:s,originPostData:r,itemIds:i,kidsQueries:n}},et=({page:t})=>{const e=tt(),[r,s,i]=ye(t,j.maxPageItems,e.data);return[r,s,i]},tt=()=>fe({queryKey:["topStories"],queryFn:Xe,cacheTime:12*5*60*1e3,staleTime:6*5*60*1e3}),rt=(t,e=!1)=>fe({queryKey:["item",t],queryFn:async()=>me(t),cacheTime:6*5*60*1e3,staleTime:3*5*60*1e3,suspense:e,enabled:!!t}),pe=(t=[])=>We({queries:t.map(e=>({queryKey:["item",e],queryFn:async()=>me(e),cacheTime:6*5*60*1e3,staleTime:3*5*60*1e3}))}),ye=(t,e,r=[])=>{const s=Math.floor(r.length/e),i=r.length%e,n=i===0?s:s+1;let u=e;t>n?u=0:t===n&&(u=i);const l=r.slice(0,(t-1)*e+u);return[n,l,pe(l)]};function ve(t){if(t===void 0)return"";const e=Date.now();return st(e,t)}function st(t,e){const r=Math.floor(t/1e3-e);let s=r/31536e3;return s>1?`${Math.floor(s)} years`:(s=r/2592e3,s>1?`${Math.floor(s)} months`:(s=r/86400,s>1?`${Math.floor(s)} days`:(s=r/3600,s>1?`${Math.floor(s)} hrs`:(s=r/60,s>1?`${Math.floor(s)} mins`:`${Math.floor(r)} secs`))))}var nt="Expected a function",X=0/0,it="[object Symbol]",ot=/^\s+|\s+$/g,ut=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,lt=/^0o[0-7]+$/i,ct=parseInt,dt=typeof N=="object"&&N&&N.Object===Object&&N,ht=typeof self=="object"&&self&&self.Object===Object&&self,ft=dt||ht||Function("return this")(),mt=Object.prototype,pt=mt.toString,yt=Math.max,vt=Math.min,P=function(){return ft.Date.now()};function bt(t,e,r){var s,i,n,u,l,d,c=0,f=!1,o=!1,h=!0;if(typeof t!="function")throw new TypeError(nt);e=Y(e)||0,q(r)&&(f=!!r.leading,o="maxWait"in r,n=o?yt(Y(r.maxWait)||0,e):n,h="trailing"in r?!!r.trailing:h);function m(y){var O=s,b=i;return s=i=void 0,c=y,u=t.apply(b,O),u}function g(y){return c=y,l=setTimeout(E,e),f?m(y):u}function x(y){var O=y-d,b=y-c,I=e-O;return o?vt(I,n-b):I}function R(y){var O=y-d,b=y-c;return d===void 0||O>=e||O<0||o&&b>=n}function E(){var y=P();if(R(y))return T(y);l=setTimeout(E,x(y))}function T(y){return l=void 0,h&&s?m(y):(s=i=void 0,u)}function S(){l!==void 0&&clearTimeout(l),c=0,s=d=i=l=void 0}function k(){return l===void 0?u:T(P())}function C(){var y=P(),O=R(y);if(s=arguments,i=this,d=y,O){if(l===void 0)return g(d);if(o)return l=setTimeout(E,e),m(d)}return l===void 0&&(l=setTimeout(E,e)),u}return C.cancel=S,C.flush=k,C}function q(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function gt(t){return!!t&&typeof t=="object"}function Rt(t){return typeof t=="symbol"||gt(t)&&pt.call(t)==it}function Y(t){if(typeof t=="number")return t;if(Rt(t))return X;if(q(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=q(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(ot,"");var r=at.test(t);return r||lt.test(t)?ct(t.slice(2),r?2:8):ut.test(t)?X:+t}var St=bt,xt=function(e,r,s){return e?St(r,e,s):r};function be(t,e){var r=v.useMemo(function(){var f,o,h,m;return{offset:(f=e==null?void 0:e.offset)!=null?f:0,debounce:(o=e==null?void 0:e.debounce)!=null?o:200,debounceOptions:(h=e==null?void 0:e.debounceOptions)!=null?h:{leading:!0},triggerOnNoScroll:(m=e==null?void 0:e.triggerOnNoScroll)!=null?m:!1}},[e==null?void 0:e.offset,e==null?void 0:e.debounce,e==null?void 0:e.debounceOptions,e==null?void 0:e.triggerOnNoScroll]),s=r.offset,i=r.triggerOnNoScroll,n=r.debounce,u=r.debounceOptions,l=v.useMemo(function(){return xt(n,t,u)},[n,t]),d=v.useRef(null),c=v.useCallback(function(){if(d.current!=null){var f=d.current,o=Math.round(f.scrollTop+f.clientHeight),h=Math.round(f.scrollHeight-s);h<=o&&l()}else{var m=document.scrollingElement||document.documentElement,g=Math.round(m.scrollTop+window.innerHeight),x=Math.round(m.scrollHeight-s);x<=g&&l()}},[s,t,d.current]);return v.useEffect(function(){var f=d.current;return f!=null?f.addEventListener("scroll",c):window.addEventListener("scroll",c),i&&c(),function(){f!=null?f.removeEventListener("scroll",c):window.removeEventListener("scroll",c)}},[c,n]),d}function Ot(){const[t,e]=v.useState(1),[r,s,i]=et({page:t}),n=be(()=>{e(u=>u<r?u+1:u)},{offset:20,debounce:300,triggerOnNoScroll:!0});return a.jsxs("div",{ref:n,className:"list-scroller w-full h-full overflow-y-scroll",children:[i.map((u,l)=>a.jsx(Qt,{item:u},s[l])),a.jsx("div",{className:"bottom-1 w-full h-[1px]"})]})}function Qt({item:t}){const e=V(j.hackerNewsStoryContentAtom),r=V(j.toggleSideBarAtom),{status:s,error:i,data:n}=t;return s==="loading"?a.jsx("div",{className:"h-12 bg-gray-900 text-gray-200 pl-2 sm:pl-8 pr-2",children:a.jsx(F,{})}):s==="error"?a.jsxs("div",{children:["Item Error: ",JSON.stringify(i)]}):(n==null?void 0:n.type)==="story"?a.jsx(jt,{item:n,onClick:()=>{e(n),r()}}):a.jsx("div",{children:"-"})}function jt(t){const{item:e,onClick:r}=t,{kids:s}=e,i=Math.floor(s.length/j.maxCommentsPerPage)+(s.length%j.maxCommentsPerPage>0?1:0),n=i<=1?"1 page":`${i} pages`;return a.jsxs("div",{className:"bg-gray-900 text-gray-200 pl-2 sm:pl-8 pr-2 cursor-pointer",onClick:r,children:[a.jsxs("div",{className:"w-full inline-block py-2",children:[a.jsxs("div",{className:"float-left",children:[a.jsxs("span",{className:"text-blue-400",children:[e.by," "]}),a.jsxs("span",{className:"",children:[ve(e.time)," "]}),a.jsxs("span",{children:["🖒",e.score??""]})]}),a.jsxs("span",{className:"float-right",children:[" ",n]})]}),a.jsx("div",{className:"pb-4 border-b-2 border-gray-200",children:a.jsxs("span",{className:"inline-block w-full text-left text-xl text-gray-100",children:[e.title," ",a.jsx("a",{href:`${e.url}`,target:"_blank",title:`${e.url}`,rel:"noreferrer",children:"🔗"})]})})]})}function Et(){const[t,e]=v.useState(1),r=Ie(j.hackerNewsStoryContentAtom),{totalPages:s,originPostData:i,itemIds:n,kidsQueries:u}=Ze({data:r,page:t}),l=be(()=>{e(d=>d<s?d+1:d)},{offset:20,debounce:300,triggerOnNoScroll:!0});return a.jsx("div",{ref:l,className:"bg-gray-900 text-gray-200 p-2 h-full overflow-y-scroll",children:a.jsxs("div",{className:"h-12",children:[a.jsx(H,{queryResult:i,floor:1},1),u.map((d,c)=>a.jsx(H,{queryResult:d,floor:c+2},n[c]))]})})}function H(t){const[e,r]=v.useState(!1),{queryResult:s,floor:i}=t;if(s.status==="loading")return a.jsx(F,{});if(s.status==="error")return a.jsxs("div",{children:["Error: ",JSON.stringify(s.error)]});const{by:n,time:u,text:l,kids:d}=s.data;return n===""?a.jsx("div",{}):a.jsxs("div",{className:"bg-gray-800 text-gray-200 px-2 my-2 py-1",children:[a.jsxs("div",{className:"flex",children:[i?a.jsxs("div",{children:["#",i," "]}):a.jsx("div",{}),a.jsx("div",{className:"text-blue-400",children:n})," ",a.jsx("div",{children:ve(u)}),a.jsx("div",{children:i!==1&&d&&d.length>0&&a.jsx("button",{type:"button",className:"px-2",onClick:()=>{r(!e)},children:" ▾"})})]}),a.jsxs("div",{children:[a.jsx("div",{dangerouslySetInnerHTML:{__html:l},className:"text-left mb-3"}),a.jsx("div",{className:"pl-4",children:i!==1&&a.jsx(v.Suspense,{fallback:a.jsx(F,{}),children:e&&a.jsx(Ct,{kids:d})})})]})]})}function Ct({kids:t}){const e=pe(t);return a.jsx(a.Fragment,{children:e.map(r=>a.jsx(H,{queryResult:r},Ce()))})}const It="_sideBarList_7scrz_2",wt={sideBarList:It};function Mt(){const[t,e]=we(j.toggleSideBarAtom);return a.jsxs("div",{children:[a.jsx("div",{className:"w-full mb-2",children:a.jsx("div",{className:"cursor-pointer select-none py-2 px-2 text-center border-solid border-2 rounded-md bg-transparent border-violet-500",onClick:()=>{e()},children:"Toggle Sidebar"})}),a.jsxs("div",{className:"flex w-full h-screen relative overflow-hidden",children:[a.jsx("div",{className:`shrink-0 ${t?"":"absolute left-[-100%]"} ${wt.sideBarList} h-full`,children:a.jsx(Ot,{})}),a.jsx("div",{className:"grow w-full",children:a.jsx(Et,{})})]})]})}export{Mt as default};
