import{S as Y,s as $,n as be,i as D,b as _,t as Re,f as Se,c as xe,d as W,e as Oe,g as Q,h as K,k as Qe,r as v,u as Z,p as je,l as N,j as a,m as Ee}from"./index-3f2a1a41.js";import{z as p,a as ee,u as J,b as Ce,c as Ie}from"./index-c4f4b7fa.js";class te extends Y{constructor(e,r){super(),this.client=e,this.options=r,this.trackedProps=new Set,this.selectError=null,this.bindMethods(),this.setOptions(r)}bindMethods(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.length===1&&(this.currentQuery.addObserver(this),V(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())}onUnsubscribe(){this.listeners.length||this.destroy()}shouldFetchOnReconnect(){return L(this.currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return L(this.currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=[],this.clearStaleTimeout(),this.clearRefetchInterval(),this.currentQuery.removeObserver(this)}setOptions(e,r){const s=this.options,i=this.currentQuery;if(this.options=this.client.defaultQueryOptions(e),$(s,this.options)||this.client.getQueryCache().notify({type:"observerOptionsUpdated",query:this.currentQuery,observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=s.queryKey),this.updateQuery();const n=this.hasListeners();n&&z(this.currentQuery,i,this.options,s)&&this.executeFetch(),this.updateResult(r),n&&(this.currentQuery!==i||this.options.enabled!==s.enabled||this.options.staleTime!==s.staleTime)&&this.updateStaleTimeout();const u=this.computeRefetchInterval();n&&(this.currentQuery!==i||this.options.enabled!==s.enabled||u!==this.currentRefetchInterval)&&this.updateRefetchInterval(u)}getOptimisticResult(e){const r=this.client.getQueryCache().build(this.client,e);return this.createResult(r,e)}getCurrentResult(){return this.currentResult}trackResult(e){const r={};return Object.keys(e).forEach(s=>{Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:()=>(this.trackedProps.add(s),e[s])})}),r}getCurrentQuery(){return this.currentQuery}remove(){this.client.getQueryCache().remove(this.currentQuery)}refetch({refetchPage:e,...r}={}){return this.fetch({...r,meta:{refetchPage:e}})}fetchOptimistic(e){const r=this.client.defaultQueryOptions(e),s=this.client.getQueryCache().build(this.client,r);return s.isFetchingOptimistic=!0,s.fetch().then(()=>this.createResult(s,r))}fetch(e){var r;return this.executeFetch({...e,cancelRefetch:(r=e.cancelRefetch)!=null?r:!0}).then(()=>(this.updateResult(),this.currentResult))}executeFetch(e){this.updateQuery();let r=this.currentQuery.fetch(this.options,e);return e!=null&&e.throwOnError||(r=r.catch(be)),r}updateStaleTimeout(){if(this.clearStaleTimeout(),D||this.currentResult.isStale||!_(this.options.staleTime))return;const r=Re(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(()=>{this.currentResult.isStale||this.updateResult()},r)}computeRefetchInterval(){var e;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(e=this.options.refetchInterval)!=null?e:!1}updateRefetchInterval(e){this.clearRefetchInterval(),this.currentRefetchInterval=e,!(D||this.options.enabled===!1||!_(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||Se.isFocused())&&this.executeFetch()},this.currentRefetchInterval))}updateTimers(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())}clearStaleTimeout(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)}clearRefetchInterval(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)}createResult(e,r){const s=this.currentQuery,i=this.options,n=this.currentResult,u=this.currentResultState,l=this.currentResultOptions,d=e!==s,c=d?e.state:this.currentQueryInitialState,f=d?this.currentResult:this.previousQueryResult,{state:o}=e;let{dataUpdatedAt:h,error:m,errorUpdatedAt:b,fetchStatus:x,status:R}=o,E=!1,T=!1,S;if(r._optimisticResults){const g=this.hasListeners(),I=!g&&V(e,r),ge=g&&z(e,s,r,i);(I||ge)&&(x=xe(e.options.networkMode)?"fetching":"paused",h||(R="loading")),r._optimisticResults==="isRestoring"&&(x="idle")}if(r.keepPreviousData&&!o.dataUpdatedAt&&f!=null&&f.isSuccess&&R!=="error")S=f.data,h=f.dataUpdatedAt,R=f.status,E=!0;else if(r.select&&typeof o.data<"u")if(n&&o.data===(u==null?void 0:u.data)&&r.select===this.selectFn)S=this.selectResult;else try{this.selectFn=r.select,S=r.select(o.data),S=W(n==null?void 0:n.data,S,r),this.selectResult=S,this.selectError=null}catch(g){this.selectError=g}else S=o.data;if(typeof r.placeholderData<"u"&&typeof S>"u"&&R==="loading"){let g;if(n!=null&&n.isPlaceholderData&&r.placeholderData===(l==null?void 0:l.placeholderData))g=n.data;else if(g=typeof r.placeholderData=="function"?r.placeholderData():r.placeholderData,r.select&&typeof g<"u")try{g=r.select(g),this.selectError=null}catch(I){this.selectError=I}typeof g<"u"&&(R="success",S=W(n==null?void 0:n.data,g,r),T=!0)}this.selectError&&(m=this.selectError,S=this.selectResult,b=Date.now(),R="error");const k=x==="fetching",C=R==="loading",y=R==="error";return{status:R,fetchStatus:x,isLoading:C,isSuccess:R==="success",isError:y,isInitialLoading:C&&k,data:S,dataUpdatedAt:h,error:m,errorUpdatedAt:b,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>c.dataUpdateCount||o.errorUpdateCount>c.errorUpdateCount,isFetching:k,isRefetching:k&&!C,isLoadingError:y&&o.dataUpdatedAt===0,isPaused:x==="paused",isPlaceholderData:T,isPreviousData:E,isRefetchError:y&&o.dataUpdatedAt!==0,isStale:H(e,r),refetch:this.refetch,remove:this.remove}}updateResult(e){const r=this.currentResult,s=this.createResult(this.currentQuery,this.options);if(this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,$(s,r))return;this.currentResult=s;const i={cache:!0},n=()=>{if(!r)return!0;const{notifyOnChangeProps:u}=this.options;if(u==="all"||!u&&!this.trackedProps.size)return!0;const l=new Set(u??this.trackedProps);return this.options.useErrorBoundary&&l.add("error"),Object.keys(this.currentResult).some(d=>{const c=d;return this.currentResult[c]!==r[c]&&l.has(c)})};(e==null?void 0:e.listeners)!==!1&&n()&&(i.listeners=!0),this.notify({...i,...e})}updateQuery(){const e=this.client.getQueryCache().build(this.client,this.options);if(e===this.currentQuery)return;const r=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(r==null||r.removeObserver(this),e.addObserver(this))}onQueryUpdate(e){const r={};e.type==="success"?r.onSuccess=!e.manual:e.type==="error"&&!Oe(e.error)&&(r.onError=!0),this.updateResult(r),this.hasListeners()&&this.updateTimers()}notify(e){Q.batch(()=>{if(e.onSuccess){var r,s,i,n;(r=(s=this.options).onSuccess)==null||r.call(s,this.currentResult.data),(i=(n=this.options).onSettled)==null||i.call(n,this.currentResult.data,null)}else if(e.onError){var u,l,d,c;(u=(l=this.options).onError)==null||u.call(l,this.currentResult.error),(d=(c=this.options).onSettled)==null||d.call(c,void 0,this.currentResult.error)}e.listeners&&this.listeners.forEach(f=>{f(this.currentResult)}),e.cache&&this.client.getQueryCache().notify({query:this.currentQuery,type:"observerResultsUpdated"})})}}function we(t,e){return e.enabled!==!1&&!t.state.dataUpdatedAt&&!(t.state.status==="error"&&e.retryOnMount===!1)}function V(t,e){return we(t,e)||t.state.dataUpdatedAt>0&&L(t,e,e.refetchOnMount)}function L(t,e,r){if(e.enabled!==!1){const s=typeof r=="function"?r(t):r;return s==="always"||s!==!1&&H(t,e)}return!1}function z(t,e,r,s){return r.enabled!==!1&&(t!==e||s.enabled===!1)&&(!r.suspense||t.state.status!=="error")&&H(t,r)}function H(t,e){return t.isStaleByTime(e.staleTime)}class Te extends Y{constructor(e,r){super(),this.client=e,this.queries=[],this.result=[],this.observers=[],this.observersMap={},r&&this.setQueries(r)}onSubscribe(){this.listeners.length===1&&this.observers.forEach(e=>{e.subscribe(r=>{this.onUpdate(e,r)})})}onUnsubscribe(){this.listeners.length||this.destroy()}destroy(){this.listeners=[],this.observers.forEach(e=>{e.destroy()})}setQueries(e,r){this.queries=e,Q.batch(()=>{const s=this.observers,i=this.findMatchingObservers(this.queries);i.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions,r));const n=i.map(c=>c.observer),u=Object.fromEntries(n.map(c=>[c.options.queryHash,c])),l=n.map(c=>c.getCurrentResult()),d=n.some((c,f)=>c!==s[f]);s.length===n.length&&!d||(this.observers=n,this.observersMap=u,this.result=l,this.hasListeners()&&(K(s,n).forEach(c=>{c.destroy()}),K(n,s).forEach(c=>{c.subscribe(f=>{this.onUpdate(c,f)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(e=>e.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(e){return this.findMatchingObservers(e).map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions))}findMatchingObservers(e){const r=this.observers,s=e.map(o=>this.client.defaultQueryOptions(o)),i=s.flatMap(o=>{const h=r.find(m=>m.options.queryHash===o.queryHash);return h!=null?[{defaultedQueryOptions:o,observer:h}]:[]}),n=i.map(o=>o.defaultedQueryOptions.queryHash),u=s.filter(o=>!n.includes(o.queryHash)),l=r.filter(o=>!i.some(h=>h.observer===o)),d=o=>{const h=this.client.defaultQueryOptions(o),m=this.observersMap[h.queryHash];return m??new te(this.client,h)},c=u.map((o,h)=>{if(o.keepPreviousData){const m=l[h];if(m!==void 0)return{defaultedQueryOptions:o,observer:m}}return{defaultedQueryOptions:o,observer:d(o)}}),f=(o,h)=>s.indexOf(o.defaultedQueryOptions)-s.indexOf(h.defaultedQueryOptions);return i.concat(c).sort(f)}onUpdate(e,r){const s=this.observers.indexOf(e);s!==-1&&(this.result=Qe(this.result,s,r),this.notify())}notify(){Q.batch(()=>{this.listeners.forEach(e=>{e(this.result)})})}}var F={},ke={get exports(){return F},set exports(t){F=t}},re={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w=v;function Ne(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Me=typeof Object.is=="function"?Object.is:Ne,Pe=w.useState,Le=w.useEffect,Fe=w.useLayoutEffect,Ae=w.useDebugValue;function Ue(t,e){var r=e(),s=Pe({inst:{value:r,getSnapshot:e}}),i=s[0].inst,n=s[1];return Fe(function(){i.value=r,i.getSnapshot=e,M(i)&&n({inst:i})},[t,r,e]),Le(function(){return M(i)&&n({inst:i}),t(function(){M(i)&&n({inst:i})})},[t]),Ae(r),r}function M(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Me(t,r)}catch{return!0}}function Be(t,e){return e()}var qe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Be:Ue;re.useSyncExternalStore=w.useSyncExternalStore!==void 0?w.useSyncExternalStore:qe;(function(t){t.exports=re})(ke);const se=F.useSyncExternalStore,ne=v.createContext(!1),ie=()=>v.useContext(ne);ne.Provider;function He(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}const $e=v.createContext(He()),oe=()=>v.useContext($e);function De(t,e){return typeof t=="function"?t(...e):!!t}const ue=(t,e)=>{(t.suspense||t.useErrorBoundary)&&(e.isReset()||(t.retryOnMount=!1))},ae=t=>{v.useEffect(()=>{t.clearReset()},[t])},le=({result:t,errorResetBoundary:e,useErrorBoundary:r,query:s})=>t.isError&&!e.isReset()&&!t.isFetching&&De(r,[t.error,s]),ce=t=>{t.suspense&&typeof t.staleTime!="number"&&(t.staleTime=1e3)},de=(t,e)=>t.isLoading&&t.isFetching&&!e,A=(t,e,r)=>(t==null?void 0:t.suspense)&&de(e,r),U=(t,e,r)=>e.fetchOptimistic(t).then(({data:s})=>{t.onSuccess==null||t.onSuccess(s),t.onSettled==null||t.onSettled(s,null)}).catch(s=>{r.clearReset(),t.onError==null||t.onError(s),t.onSettled==null||t.onSettled(void 0,s)});function _e({queries:t,context:e}){const r=Z({context:e}),s=ie(),i=v.useMemo(()=>t.map(o=>{const h=r.defaultQueryOptions(o);return h._optimisticResults=s?"isRestoring":"optimistic",h}),[t,r,s]),[n]=v.useState(()=>new Te(r,i)),u=n.getOptimisticResult(i);se(v.useCallback(o=>s?()=>{}:n.subscribe(Q.batchCalls(o)),[n,s]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),v.useEffect(()=>{n.setQueries(i,{listeners:!1})},[i,n]);const l=oe();i.forEach(o=>{ue(o,l),ce(o)}),ae(l);const c=u.some((o,h)=>A(i[h],o,s))?u.flatMap((o,h)=>{const m=i[h],b=n.getObservers()[h];if(m&&b){if(A(m,o,s))return U(m,b,l);de(o,s)&&U(m,b,l)}return[]}):[];if(c.length>0)throw Promise.all(c);const f=u.find((o,h)=>{var m,b;return le({result:o,errorResetBoundary:l,useErrorBoundary:(m=(b=i[h])==null?void 0:b.useErrorBoundary)!=null?m:!1,query:n.getQueries()[h]})});if(f!=null&&f.error)throw f.error;return u}function We(t,e){const r=Z({context:t.context}),s=ie(),i=oe(),n=r.defaultQueryOptions(t);n._optimisticResults=s?"isRestoring":"optimistic",n.onError&&(n.onError=Q.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=Q.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=Q.batchCalls(n.onSettled)),ce(n),ue(n,i),ae(i);const[u]=v.useState(()=>new e(r,n)),l=u.getOptimisticResult(n);if(se(v.useCallback(d=>s?()=>{}:u.subscribe(Q.batchCalls(d)),[u,s]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),v.useEffect(()=>{u.setOptions(n,{listeners:!1})},[n,u]),A(n,l,s))throw U(n,u,i);if(le({result:l,errorResetBoundary:i,useErrorBoundary:n.useErrorBoundary,query:u.getCurrentQuery()}))throw l.error;return n.notifyOnChangeProps?l:u.trackResult(l)}function he(t,e,r){const s=je(t,e,r);return We(s,te)}const Ke=p.array(p.number()).default([]),Je=p.object({id:p.number(),deleted:p.boolean().optional().default(!1),type:p.string(),by:p.string().optional().default(""),time:p.number().optional(),dead:p.boolean().optional().default(!1),kids:p.array(p.number()).optional().default([]),descendants:p.number().optional(),score:p.number().optional(),title:p.string().optional().default(""),url:p.string().optional().default("")}),Ve=p.object({id:p.number(),deleted:p.boolean().optional().default(!1),type:p.string(),by:p.string().optional().default(""),time:p.number().optional(),kids:p.array(p.number()).optional().default([]),parent:p.number().optional(),text:p.string().optional().default("")}),ze=Je.merge(Ve),Ge=async()=>{const t=await fetch("https://hacker-news.firebaseio.com/v0/topstories.json");return t.status!==200?Promise.reject(new Error(`Failed to fetch top stories res.status:${t.status}`)):t.json().then(async e=>{const r=Ke.safeParse(e);return r.success?r.data:Promise.reject(new Error(`Failed to parse top stories json:${JSON.stringify(e)}`))})},fe=async t=>{const e=await fetch(`https://hacker-news.firebaseio.com/v0/item/${t}.json`);return e.status!==200?Promise.reject(new Error(`Failed to fetch item ${t} res.status:${e.status}`)):e.json().then(async r=>{const s=ze.safeParse(r);return s.success?s.data:Promise.reject(new Error(`Failed to parse item itemID:${t} json:${JSON.stringify(r)}`))})},j={maxPageItems:9,maxCommentsPerPage:20,hackerNewsStoryContentAtom:ee({}),toggleSideBarAtom:Xe(!0)};function Xe(t=!1){const e=ee(t,(r,s,i)=>{const n=i??!r(e);s(e,n)});return e}const Ye=({data:t,page:e})=>{const r=tt(t.id),[s,i,n]=pe(e,j.maxCommentsPerPage,t.kids);return{totalPages:s,originPostData:r,itemIds:i,kidsQueries:n}},Ze=({page:t})=>{const e=et(),[r,s,i]=pe(t,j.maxPageItems,e.data);return[r,s,i]},et=()=>he({queryKey:["topStories"],queryFn:Ge,cacheTime:12*5*60*1e3,staleTime:6*5*60*1e3}),tt=(t,e=!1)=>he({queryKey:["item",t],queryFn:async()=>fe(t),cacheTime:6*5*60*1e3,staleTime:3*5*60*1e3,suspense:e,enabled:!!t}),me=(t=[])=>_e({queries:t.map(e=>({queryKey:["item",e],queryFn:async()=>fe(e),cacheTime:6*5*60*1e3,staleTime:3*5*60*1e3}))}),pe=(t,e,r=[])=>{const s=Math.floor(r.length/e),i=r.length%e,n=i===0?s:s+1;let u=e;t>n?u=0:t===n&&(u=i);const l=r.slice(0,(t-1)*e+u);return[n,l,me(l)]};function ye(t){if(t===void 0)return"";const e=Date.now();return rt(e,t)}function rt(t,e){const r=Math.floor(t/1e3-e);let s=r/31536e3;return s>1?`${Math.floor(s)} years`:(s=r/2592e3,s>1?`${Math.floor(s)} months`:(s=r/86400,s>1?`${Math.floor(s)} days`:(s=r/3600,s>1?`${Math.floor(s)} hrs`:(s=r/60,s>1?`${Math.floor(s)} mins`:`${Math.floor(r)} secs`))))}var st="Expected a function",G=0/0,nt="[object Symbol]",it=/^\s+|\s+$/g,ot=/^[-+]0x[0-9a-f]+$/i,ut=/^0b[01]+$/i,at=/^0o[0-7]+$/i,lt=parseInt,ct=typeof N=="object"&&N&&N.Object===Object&&N,dt=typeof self=="object"&&self&&self.Object===Object&&self,ht=ct||dt||Function("return this")(),ft=Object.prototype,mt=ft.toString,pt=Math.max,yt=Math.min,P=function(){return ht.Date.now()};function vt(t,e,r){var s,i,n,u,l,d,c=0,f=!1,o=!1,h=!0;if(typeof t!="function")throw new TypeError(st);e=X(e)||0,B(r)&&(f=!!r.leading,o="maxWait"in r,n=o?pt(X(r.maxWait)||0,e):n,h="trailing"in r?!!r.trailing:h);function m(y){var O=s,g=i;return s=i=void 0,c=y,u=t.apply(g,O),u}function b(y){return c=y,l=setTimeout(E,e),f?m(y):u}function x(y){var O=y-d,g=y-c,I=e-O;return o?yt(I,n-g):I}function R(y){var O=y-d,g=y-c;return d===void 0||O>=e||O<0||o&&g>=n}function E(){var y=P();if(R(y))return T(y);l=setTimeout(E,x(y))}function T(y){return l=void 0,h&&s?m(y):(s=i=void 0,u)}function S(){l!==void 0&&clearTimeout(l),c=0,s=d=i=l=void 0}function k(){return l===void 0?u:T(P())}function C(){var y=P(),O=R(y);if(s=arguments,i=this,d=y,O){if(l===void 0)return b(d);if(o)return l=setTimeout(E,e),m(d)}return l===void 0&&(l=setTimeout(E,e)),u}return C.cancel=S,C.flush=k,C}function B(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function gt(t){return!!t&&typeof t=="object"}function bt(t){return typeof t=="symbol"||gt(t)&&mt.call(t)==nt}function X(t){if(typeof t=="number")return t;if(bt(t))return G;if(B(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=B(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(it,"");var r=ut.test(t);return r||at.test(t)?lt(t.slice(2),r?2:8):ot.test(t)?G:+t}var Rt=vt,St=function(e,r,s){return e?Rt(r,e,s):r};function ve(t,e){var r=v.useMemo(function(){var f,o,h,m;return{offset:(f=e==null?void 0:e.offset)!=null?f:0,debounce:(o=e==null?void 0:e.debounce)!=null?o:200,debounceOptions:(h=e==null?void 0:e.debounceOptions)!=null?h:{leading:!0},triggerOnNoScroll:(m=e==null?void 0:e.triggerOnNoScroll)!=null?m:!1}},[e==null?void 0:e.offset,e==null?void 0:e.debounce,e==null?void 0:e.debounceOptions,e==null?void 0:e.triggerOnNoScroll]),s=r.offset,i=r.triggerOnNoScroll,n=r.debounce,u=r.debounceOptions,l=v.useMemo(function(){return St(n,t,u)},[n,t]),d=v.useRef(null),c=v.useCallback(function(){if(d.current!=null){var f=d.current,o=Math.round(f.scrollTop+f.clientHeight),h=Math.round(f.scrollHeight-s);h<=o&&l()}else{var m=document.scrollingElement||document.documentElement,b=Math.round(m.scrollTop+window.innerHeight),x=Math.round(m.scrollHeight-s);x<=b&&l()}},[s,t,d.current]);return v.useEffect(function(){var f=d.current;return f!=null?f.addEventListener("scroll",c):window.addEventListener("scroll",c),i&&c(),function(){f!=null?f.removeEventListener("scroll",c):window.removeEventListener("scroll",c)}},[c,n]),d}function xt(){const[t,e]=v.useState(1),[r,s,i]=Ze({page:t}),n=ve(()=>{e(u=>u<r?u+1:u)},{offset:20,debounce:300,triggerOnNoScroll:!0});return a.jsxs("div",{ref:n,className:"list-scroller w-full h-full overflow-y-scroll",children:[i.map((u,l)=>a.jsx(Ot,{item:u},s[l])),a.jsx("div",{className:"bottom-1 w-full h-[1px]"})]})}function Ot({item:t}){const e=J(j.hackerNewsStoryContentAtom),r=J(j.toggleSideBarAtom),{status:s,error:i,data:n}=t;return s==="loading"?a.jsx("div",{className:"bg-gray-900 text-gray-200 pl-2 sm:pl-8 pr-2",children:"Item Loading..."}):s==="error"?a.jsxs("div",{children:["Item Error: ",JSON.stringify(i)]}):(n==null?void 0:n.type)==="story"?a.jsx(Qt,{item:n,onClick:()=>{e(n),r()}}):a.jsx("div",{children:"-"})}function Qt(t){const{item:e,onClick:r}=t,{kids:s}=e,i=Math.floor(s.length/j.maxCommentsPerPage)+(s.length%j.maxCommentsPerPage>0?1:0),n=i<=1?"1 page":`${i} pages`;return a.jsxs("div",{className:"bg-gray-900 text-gray-200 pl-2 sm:pl-8 pr-2 cursor-pointer",onClick:r,children:[a.jsxs("div",{className:"w-full inline-block py-2",children:[a.jsxs("div",{className:"float-left",children:[a.jsxs("span",{className:"text-blue-400",children:[e.by," "]}),a.jsxs("span",{className:"",children:[ye(e.time)," "]}),a.jsxs("span",{children:["🖒",e.score??""]})]}),a.jsxs("span",{className:"float-right",children:[" ",n]})]}),a.jsx("div",{className:"pb-4 border-b-2 border-gray-200",children:a.jsxs("span",{className:"inline-block w-full text-left text-xl text-gray-100",children:[e.title," ",a.jsx("a",{href:`${e.url}`,target:"_blank",title:`${e.url}`,rel:"noreferrer",children:"🔗"})]})})]})}function jt(){const[t,e]=v.useState(1),r=Ce(j.hackerNewsStoryContentAtom),{totalPages:s,originPostData:i,itemIds:n,kidsQueries:u}=Ye({data:r,page:t}),l=ve(()=>{e(d=>d<s?d+1:d)},{offset:20,debounce:300,triggerOnNoScroll:!0});return a.jsx("div",{ref:l,className:"bg-gray-900 text-gray-200 p-2 h-full overflow-y-scroll",children:a.jsxs("div",{children:[a.jsx(q,{queryResult:i,floor:1},1),u.map((d,c)=>a.jsx(q,{queryResult:d,floor:c+2},n[c]))]})})}function q(t){const[e,r]=v.useState(!1),{queryResult:s,floor:i}=t;if(s.status==="loading")return a.jsx("div",{children:"Loading..."});if(s.status==="error")return a.jsxs("div",{children:["Error: ",JSON.stringify(s.error)]});const{by:n,time:u,text:l,kids:d}=s.data;return n===""?a.jsx("div",{}):a.jsxs("div",{className:"bg-gray-800 text-gray-200 px-2 my-2 py-1",children:[a.jsxs("div",{className:"flex",children:[i?a.jsxs("div",{children:["#",i," "]}):a.jsx("div",{}),a.jsx("div",{className:"text-blue-400",children:n})," ",a.jsx("div",{children:ye(u)}),a.jsx("div",{children:i!==1&&d&&d.length>0&&a.jsx("button",{type:"button",className:"px-2",onClick:()=>{r(!e)},children:" ▾"})})]}),a.jsxs("div",{children:[a.jsx("div",{dangerouslySetInnerHTML:{__html:l},className:"text-left mb-3"}),a.jsx("div",{className:"pl-4",children:i!==1&&a.jsx(v.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:e&&a.jsx(Et,{kids:d})})})]})]})}function Et({kids:t}){const e=me(t);return a.jsx(a.Fragment,{children:e.map(r=>a.jsx(q,{queryResult:r},Ee()))})}const Ct="_sideBarList_7scrz_2",It={sideBarList:Ct};function kt(){const[t,e]=Ie(j.toggleSideBarAtom);return a.jsxs("div",{children:[a.jsx("div",{className:"w-full mb-2",children:a.jsx("div",{className:"cursor-pointer select-none py-2 px-2 text-center border-solid border-2 rounded-md bg-transparent border-violet-500",onClick:()=>{e()},children:"Toggle Sidebar"})}),a.jsxs("div",{className:"flex w-full h-screen relative overflow-hidden",children:[a.jsx("div",{className:`shrink-0 ${t?"":"absolute left-[-100%]"} ${It.sideBarList} h-full`,children:a.jsx(xt,{})}),a.jsx("div",{className:"grow w-full",children:a.jsx(jt,{})})]})]})}export{kt as default};
